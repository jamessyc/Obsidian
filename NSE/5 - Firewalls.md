## What is a Firewall?

A computer or network security system that sits between your internal network and the rest of the network  
Firewalls implement access control for a network

### Objectives of a Firewall

- Prevents bad things (external malicious actors gaining access to the system) from happening without preventing good things (accessing information from outside the firewall) from happening

### Implementation

- Forms a barrier through which all traffic must pass  
- A choke point which imposes restrictions

### Techniques for Firewall Access Control

- Service control  
  - Determines the types of internet services that can be accessed (in or out)  
- Direction control  
  - Determines the direction in which particular service requests may be initiated and allowed to flow through the firewall  
- User control  
  - Controls access to a service based on which user is accessing it  
- Behaviour control  
  - Controls how particular services are used

### Types

- A positive filter  
  - Assume packets are guilty until proven innocent  
- A negative filter  
  - Assume packets are innocent until proven guilty  
- Depending on the type of firewall, may examine:  
  - Protocol headers of a packet  
  - Payload of a packet  
  - Pattern generated by a sequence of packets

### Limitations

- Cannot protect against:  
  - Attacks that bypass the firewall  
  - Malware on the local network  
  - Internal threats  
  - Access via wifi networks if improperly secured  
    - I.e. if the wifi you are on is not secure, the attacker can connect directly to the network rather than communicating through the firewall

#### sneakernet

- an informal term  
- refers to the transport of malware physically  
  - i.e. through USBs, CDs, external hard drives etc  
- not over internet

## Packet Filtering Firewall

Simple, fastest firewall  
Foundation of any firewall system  
Control access to ports (services)  
Filters packets based on rules

- In both directions

### Filtering Rules

- Based on firewall interface and information in network packet  
  - Interface  
    - Which interface did the packet come from?  
    - Which interface is it going to?  
  - Information in the packet  
    - Source IP  
    - Destination IP  
    - Source and destination port  
    - IP protocol field (the transport protocol used, TCP or UDP)  
- Packet filtering firewall’s rules are usually based on matches to fields in the IP or TCP header  
  - If a matching rule is found, the rule is invoked to determine the behaviour (forward / discard)  
  - If no rules matched, a default behaviour occurs  
    - Default behaviour is based on whether the firewall is positively or negatively filtering

### Granularity

- Depends on the type of router used for the firewall  
- Filtering can be done at:  
  - Input time (incoming packet)  
  - Output time (outgoing packet)  
  - Input and output time  
  - By looking at control fields of packets

### Examples

Note that rules are applied from top to bottom  
Default behaviour is block, rules represent a whitelist  
Note that rules A, B and C don’t specify source and destination, and thus are bidirectional rules  ![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcxcsJEjKeW4Sd0MGXwIjupFAwcim5K9Vhl55qFIEhlop85SRuTmMtrg3KfUdNkOPwkcfu7V3GvF6weF9F8BW6B7pmA5OQCc1IonelbfmAb63FUuYSdHwB3YsHUQ9Km44KP9VuELA?key=QsrhzRGmibZ4Z-AewHplBmKW)
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcK-R_MqR0Sofj0zqMuskvE-8DYB4aKQivez0AA5qc18ToHpVVULMzmMjdlq56txlafJW_kD5mVvNzPPV9xh0OdQtcf9hLaPIiF1HznR3E_bNYCY9M-igR6r2nppbKqHqP6QVnKLA?key=QsrhzRGmibZ4Z-AewHplBmKW)
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcTXb9JQe2iSAAwUykP10nmJistfW_DR8WRc3PuyoccKVWA4Lg9rSxMlWC_Ho2-oi5s9YaMY9bF5u_vCjtBlQv3EVsXbXZ_VBNKHvfw22taGsyk48FaywSiiwnapjQWdbMZmBLe8w?key=QsrhzRGmibZ4Z-AewHplBmKW)
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfA4B3qFVHLfgzvOnsYBxm_WqZUl1lZnkuyGNVPHkeDzmsvbEfJKJgH-3-xzu2IFeRgZE9hPhz4R5aoHpvlxCtenTkCA7VEJrD4GvqCPKvL3TLlIh1N7OfvwTzsr7t8cwll4Ojo1A?key=QsrhzRGmibZ4Z-AewHplBmKW)
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfd-axVm-jsGb0OoUjiFwq6F73Z7DbYB_aom_JHTK5tY1_LTZmKQhhPMJFBYGGl5bdyuImaO5o2qxfdx9hh4PE5TUUoD_pCU7fz-0D7-JwcRE1fXJ-6WE9PFkhqjSeu7B0veYqQ9g?key=QsrhzRGmibZ4Z-AewHplBmKW)
### Advantages

Simple  
Rules are transparent to users, and fast

### Disadvantages

- No examination of upper-layer data, so no prevention of attacks that exploit app-specific vulnerabilities  
  - Can’t block specific application commands  
  - If an application is allowed by the firewall, then all functions of that application will be allowed  
- Because of limited info available to the firewall, logging functionality is limited  
  - Logs only contain the same info used to make the access control decisions  
- Do not support advanced user authentication schemes

### Vulnerabilities

- Generally vulnerable to attacks that take advantage of TCP/IP vulnerabilities, such as spoofing  
  - Can’t detect an altered IP address in a packet  
- Susceptible to misconfiguration  
  - Due to small number of variables in use, one small error can result in a large vulnerability

### Attacks and countermeasures

- IP address spoofing  
  - Attack  
    - Attacker sets source IP to be an internal host  
  - Countermeasure  
    - Add filters on router to block stuff that says its from an internal host  
- Source routing attack  
  - Attack  
    - There’s an option for the sender of a packet to include info on the route a packet should take to get to its destination  
    - An attacker can use this to generate traffic claiming to be from inside the firewall  
  - Countermeasure  
    - Block source routed packets  
    - Discard all packets that use this option  
    - (Source routing is not commonly used outside of debugging and network congestion control)  
- Tiny fragment attacks  
  - Attack  
    - Split TCP header information over several packets using IP fragmentation  
    - Circumvents filtering rules based on TCP header information  
    - Hope that firewall only examines first fragment and lets the rest through  
  - Countermeasure  
    - Discard all packets that use the TCP protocol and are fragmented, OR reassemble packets before checking  
    - Enforce a rule that the first fragment of a packet must contain some minimum amount of the TCP header

## 

## Stateful Firewall

Packet filters don’t take additional context into account when considering an individual packet  
Stateful packet filters address this need by examining each packet in context by:

- Keeping track of client-server sessions (by recording TCP connection info)  
- Checking whether each packet belongs to a session  
- Able to better detect bogus packets out of context  
- Can even inspect a limited amount of application data

### TCP Port Numbers

- TCP port for server is \<1024  
  - Permanently assigned, e.g. 25 for SMTP  
- TCP port for client is \>1024 but \<65535 (16 bit TCP port)  
  - Generated dynamically, only have significance for the lifetime of a connection

For a simple packet filtering firewall, the firewall has to allow communication for all these high numbered ports from a server’s perspective. This creates a vulnerability

### Stateful TCP Filtering

Creates a directory of outbound TCP connections  
E.g.:  
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXf_bT9eU701jLmCyt7A_Nckg6HwzhfzSaCLKizHpL47Yup-IKhD4aVkEN1MsAuatlja0sjKQFayeoYkld2Ttn_K1SqbFahDQSMhOAOigZztT3EjGlNdl2NKmpxUyHxOoJUotGKKnA?key=QsrhzRGmibZ4Z-AewHplBmKW)

- Then, allow incoming traffic to ports for packets that fit the profile  
  - I.e., a port should only receive incoming traffic from a specific IP  
- Can also track TCP sequence numbers (to prevent TCP session hijacking)

## 

## Application-level Proxy Firewall

- Acts as a relay for application-level traffic  
- Steps:  
  - User contacts gateway using a TCP/IP app (e.g Telnet, FTP)  
  - Gateway asks user for name of remote host to be accessed  
  - User responds with name \+ User ID \+ authentication information  
  - Gateway contacts application on remote host and relays TCP segments containing application data between the two endpoints  
- If the gateway doesn’t implement the proxy code for a specific app, then the service cannot be contacted through the firewall  
- Can be configured to support only specific features of an app, while denying all other features

### Advantages

- More secure than packet filtering  
  - Only needs to scrutinize a few allowable applications  
  - Easy to audit and log application-level traffic

### Disadvantages

- Need separate proxies for every service  
- Additional processing overhead on each connection  
  - Two spliced connections between the end users  
  - Gateway is at the splice point and must examine and forward all traffic in both directions

## Circuit-level Proxy Firewall

- Like an application-level proxy firewall but at the transport level  
- Acts as a relay for transport-level traffic  
- Can be standalone, or implemented by a specific application-level proxy gateway  
- Sets up two TCP connections:  
  - 1 between itself and the internal host  
  - 1 between itself and the external host  
- Once the connections are established, relays the TCP segments from one connection to the other without examining the contents  
- Security: Determines which connections will be allowed  
- Typically used when network admin trusts internal users and generally allows outbound connections  
  - Can be configured to support application-level proxy on inbound connections, and circuit-level proxies on outbound connections.  
  - So still has the processing overhead for incoming traffic (application level processing overhead) but not on outbound traffic

## Firewalls Visualised
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcI7ye5klbuzD0DwslVChDkhAnC_XlD019GrxlTZNtMqvq8Y62MSfspNimq_JEyWFPGKO-J2P0m0P83vBryDCNTBd8appLQmJ8xeJPdh6WgQh82N7zoc4ddTRZGYJXD2-Z1G3Y_dA?key=QsrhzRGmibZ4Z-AewHplBmKW)
[[6 - NSE Reading Week]]